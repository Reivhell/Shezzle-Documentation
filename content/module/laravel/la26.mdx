---
title: "Sesi 26: Database Configuration & Migrations"
description: "Laravel mendukung multiple database connections secara native. Konfigurasi utama terletak di `config/database.php`."
category: "laravel"
tags: ["laravel", "database"]
order: 26
---

# Sesi 26: Database Configuration & Migrations

## Konfigurasi Database Connections

Laravel mendukung multiple database connections secara native. Konfigurasi utama terletak di `config/database.php`.

### Supported Databases

<div class="tabs-container">

### MySQL/MariaDB

```php
// config/database.php
'mysql' => [
    'driver' => 'mysql',
    'url' => env('DATABASE_URL'),
    'host' => env('DB_HOST', '127.0.0.1'),
    'port' => env('DB_PORT', '3306'),
    'database' => env('DB_DATABASE', 'forge'),
    'username' => env('DB_USERNAME', 'forge'),
    'password' => env('DB_PASSWORD', ''),
    'unix_socket' => env('DB_SOCKET', ''),
    'charset' => 'utf8mb4',
    'collation' => 'utf8mb4_unicode_ci',
    'prefix' => '',
    'prefix_indexes' => true,
    'strict' => true,
    'engine' => null,
    'options' => extension_loaded('pdo_mysql') ? array_filter([
        PDO::MYSQL_ATTR_SSL_CA => env('MYSQL_ATTR_SSL_CA'),
    ]) : [],
],
```

### PostgreSQL

```php
'pgsql' => [
    'driver' => 'pgsql',
    'url' => env('DATABASE_URL'),
    'host' => env('DB_HOST', '127.0.0.1'),
    'port' => env('DB_PORT', '5432'),
    'database' => env('DB_DATABASE', 'forge'),
    'username' => env('DB_USERNAME', 'forge'),
    'password' => env('DB_PASSWORD', ''),
    'charset' => 'utf8',
    'prefix' => '',
    'prefix_indexes' => true,
    'search_path' => 'public',
    'sslmode' => 'prefer',
],
```

### SQLite

```php
'sqlite' => [
    'driver' => 'sqlite',
    'url' => env('DATABASE_URL'),
    'database' => env('DB_DATABASE', database_path('database.sqlite')),
    'prefix' => '',
    'foreign_key_constraints' => env('DB_FOREIGN_KEYS', true),
],
```

### SQL Server

```php
'sqlsrv' => [
    'driver' => 'sqlsrv',
    'url' => env('DATABASE_URL'),
    'host' => env('DB_HOST', 'localhost'),
    'port' => env('DB_PORT', '1433'),
    'database' => env('DB_DATABASE', 'forge'),
    'username' => env('DB_USERNAME', 'forge'),
    'password' => env('DB_PASSWORD', ''),
    'charset' => 'utf8',
    'prefix' => '',
    'prefix_indexes' => true,
    'encrypt' => env('DB_ENCRYPT', 'yes'),
    'trust_server_certificate' => env('DB_TRUST_SERVER_CERTIFICATE', 'false'),
],
```

</div>

### Multiple Database Connections

```php
// Menggunakan connection berbeda
$users = DB::connection('mysql')->select('select * from users');
$orders = DB::connection('pgsql')->table('orders')->get();

// Model dengan connection berbeda
class Order extends Model
{
    protected $connection = 'pgsql';
}

// Runtime connection switching
$user = new User;
$user->setConnection('mysql_replica');
$user->save();
```

## Migration Structure & Conventions

1. **Membuat Migration**
   ```bash
   php artisan make:migration create_users_table
   php artisan make:migration add_status_to_orders --table=orders
   php artisan make:migration create_orders_table --create=orders
   ```

2. **Struktur File Migration**
   ```php
   <?php
   
   use Illuminate\Database\Migrations\Migration;
   use Illuminate\Database\Schema\Blueprint;
   use Illuminate\Support\Facades\Schema;
   
   return new class extends Migration
   {
       public function up(): void
       {
           Schema::create('users', function (Blueprint $table) {
               $table->id();
               $table->string('name');
               $table->string('email')->unique();
               $table->timestamp('email_verified_at')->nullable();
               $table->string('password');
               $table->rememberToken();
               $table->timestamps();
           });
       }
   
       public function down(): void
       {
           Schema::dropIfExists('users');
       }
   };
   ```

3. **Menjalankan Migration**
   ```bash
   php artisan migrate                    # Jalankan semua pending migrations
   php artisan migrate --force            # Production mode
   php artisan migrate --step             # Batch demi batch
   php artisan migrate:rollback           # Rollback batch terakhir
   php artisan migrate:rollback --step=3  # Rollback 3 batch terakhir
   php artisan migrate:reset              # Rollback semua migrations
   php artisan migrate:refresh            # Reset + migrate ulang
   php artisan migrate:fresh              # Drop all tables + migrate
   ```

## Schema Builder

### Column Types

```php
Schema::create('products', function (Blueprint $table) {
    // Identifiers
    $table->id();                          // BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY
    $table->uuid('id')->primary();         // UUID primary key
    $table->ulid('id')->primary();         // ULID primary key
    
    // Strings
    $table->string('name', 255);           // VARCHAR(255)
    $table->text('description');           // TEXT
    $table->mediumText('content');         // MEDIUMTEXT
    $table->longText('body');              // LONGTEXT
    
    // Numbers
    $table->integer('quantity');           // INT
    $table->bigInteger('views');           // BIGINT
    $table->unsignedBigInteger('user_id'); // BIGINT UNSIGNED
    $table->decimal('price', 8, 2);        // DECIMAL(8,2)
    $table->float('rating', 8, 2);         // FLOAT(8,2)
    $table->double('amount', 15, 8);       // DOUBLE(15,8)
    
    // Dates & Times
    $table->date('birth_date');
    $table->dateTime('published_at');
    $table->timestamp('verified_at')->nullable();
    $table->timestamps();                  // created_at & updated_at
    $table->softDeletes();                 // deleted_at
    
    // Boolean & Enum
    $table->boolean('is_active')->default(true);
    $table->enum('status', ['pending', 'approved', 'rejected']);
    
    // JSON
    $table->json('metadata');
    $table->jsonb('settings');             // PostgreSQL optimized JSON
    
    // Special
    $table->ipAddress('visitor');
    $table->macAddress('device');
    $table->geometry('coordinates');       // MySQL/PostgreSQL
    $table->point('location');             // Spatial data
});
```

### Indexes & Foreign Keys

```php
Schema::create('posts', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')
          ->constrained()                  // references id on users
          ->onDelete('cascade');
    
    $table->foreignId('category_id')
          ->constrained()
          ->onUpdate('cascade')
          ->onDelete('restrict');
    
    // Index types
    $table->index('email');                // Basic index
    $table->unique('slug');                // Unique index
    $table->fullText('content');           // Full-text search (MySQL/PostgreSQL)
    $table->spatialIndex('location');      // Spatial index
    
    // Composite indexes
    $table->index(['user_id', 'created_at']);
    $table->unique(['team_id', 'email']);
    
    // Named indexes
    $table->index('email', 'idx_user_email');
});
```

### Modifying Columns

```php
// Menambah kolom
Schema::table('users', function (Blueprint $table) {
    $table->string('phone')->after('email');
    $table->boolean('is_verified')->default(false)->first();
});

// Mengubah kolom (requires doctrine/dbal)
Schema::table('users', function (Blueprint $table) {
    $table->string('name', 100)->change();
    $table->integer('votes')->unsigned()->default(1)->change();
});

// Menghapus kolom
Schema::table('users', function (Blueprint $table) {
    $table->dropColumn('votes');
    $table->dropColumn(['votes', 'avatar', 'location']);
});

// Menghapus indexes
$table->dropPrimary('users_id_primary');
$table->dropUnique('users_email_unique');
$table->dropIndex('geo_state_index');
$table->dropForeign('posts_user_id_foreign');
```

## Migration Squashing

Migration squashing menggabungkan banyak migration files menjadi satu schema file untuk performance.

```bash
# Squash ke schema file
php artisan schema:dump

# Squash dan prune migrations
php artisan schema:dump --prune

# Prune tanpa dump (hapus migrations yang sudah dijalankan)
php artisan migrate:prune
```

Struktur yang dihasilkan:
```sql
-- database/schema/mysql-schema.sql
-- Auto-generated schema dump
-- Migration: 2024_01_15_000000_create_users_table
-- Migration: 2024_01_16_000000_create_posts_table
-- ... (semua migrations digabung)

CREATE TABLE `users` (
  `id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL,
  `email` varchar(255) NOT NULL,
  ...
  PRIMARY KEY (`id`),
  UNIQUE KEY `users_email_unique` (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

:::tip[Best Practice]
Gunakan migration squashing ketika Anda memiliki 100+ migration files untuk mempercepat `php artisan migrate` di environment baru.
:::
