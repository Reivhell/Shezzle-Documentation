---
title: "Sesi 20: Security Features"
description: "CSP adalah mekanisme pertahanan pertama yang mencegah XSS (Cross-Site Scripting) dengan mengontrol resource apa saja yang boleh dimuat browser."
category: "astrojs"
tags: ["astrojs", "security"]
order: 20
---

# Sesi 20: Security Features - Panduan Keamanan Lengkap Astro

## 20.1 Content Security Policy (CSP)

CSP adalah mekanisme pertahanan pertama yang mencegah XSS (Cross-Site Scripting) dengan mengontrol resource apa saja yang boleh dimuat browser.

### Analogi Sederhana:

> Bayangkan CSP seperti **daftar tamu di acara eksklusif**. Security guard (browser) hanya mengizinkan orang (resources) yang ada di daftar tamu untuk masuk. Orang yang tidak dikenal? Ditolak mentah-mentah, meskipun mereka punya undangan palsu (malicious scripts).

### CSP Directives Lengkap:

| Directive | Fungsi | Contoh Value |
|-----------|--------|--------------|
| `default-src` | Fallback untuk semua | `'self'` |
| `script-src` | JavaScript sources | `'self' 'unsafe-inline' https://cdn.example.com` |
| `style-src` | CSS sources | `'self' 'unsafe-inline'` |
| `img-src` | Image sources | `'self' data: https:` |
| `font-src` | Font sources | `'self' https://fonts.gstatic.com` |
| `connect-src` | Fetch/XHR/WebSocket | `'self' https://api.example.com` |
| `media-src` | Audio/video | `'self'` |
| `object-src` | Flash, plugins | `'none'` |
| `frame-src` | Iframes | `'self' https://www.youtube.com` |
| `frame-ancestors` | Embedding di site lain | `'none'` |
| `base-uri` | Base URL | `'self'` |
| `form-action` | Form submission targets | `'self'` |
| `upgrade-insecure-requests` | Force HTTPS | (boolean) |
| `report-uri` | Violation reporting | `/api/csp-report` |

### Implementasi CSP di Astro:

#### Level 1: Basic CSP (Strict)

```javascript
// astro.config.mjs
import { defineConfig } from 'astro/config';

export default defineConfig({
  security: {
    headers: {
      // Strict CSP - most secure
      'Content-Security-Policy': [
        "default-src 'self'",
        "script-src 'self' 'unsafe-inline'", // Astro needs inline for hydration
        "style-src 'self' 'unsafe-inline'",  // Scoped styles need inline
        "img-src 'self' data: https:",
        "font-src 'self'",
        "connect-src 'self'",
        "media-src 'self'",
        "object-src 'none'",
        "frame-ancestors 'none'",
        "base-uri 'self'",
        "form-action 'self'",
        "upgrade-insecure-requests",
      ].join('; '),
    },
  },
});
```

#### Level 2: CSP dengan Nonce (Lebih Aman)

```javascript
// src/middleware/csp.js
import { defineMiddleware } from 'astro:middleware';
import { randomBytes } from 'crypto';

export const cspMiddleware = defineMiddleware(async (context, next) => {
  // Generate nonce unik per request
  const nonce = randomBytes(16).toString('base64');
  context.locals.nonce = nonce;
  
  const response = await next();
  
  // CSP dengan nonce
  const csp = [
    "default-src 'self'",
    `script-src 'self' 'nonce-${nonce}' 'strict-dynamic'`, // Nonce untuk inline scripts
    `style-src 'self' 'nonce-${nonce}'`,
    "img-src 'self' data: https:",
    "font-src 'self'",
    "connect-src 'self'",
    "object-src 'none'",
    "frame-ancestors 'none'",
    "base-uri 'self'",
    "require-trusted-types-for 'script'", // Trusted Types
    "trusted-types default", // Trusted Types policy
  ].join('; ');
  
  response.headers.set('Content-Security-Policy', csp);
  
  return response;
});
```

```astro
---
// src/layouts/BaseLayout.astro
const nonce = Astro.locals.nonce;
---

<!DOCTYPE html>
<html>
  <head>
    <!-- External scripts dengan nonce -->
    <script nonce={nonce} src="/js/app.js"></script>
    
    <!-- Inline scripts dengan nonce -->
    <script nonce={nonce}>
      console.log('This script is allowed because of nonce');
    </script>
    
    <!-- Styles dengan nonce -->
    <style nonce={nonce}>
      /* Scoped styles */
    </style>
  </head>
  <body>
    <slot />
  </body>
</html>
```

#### Level 3: CSP dengan Hash (Strictest)

```javascript
// astro.config.mjs
import { createHash } from 'crypto';

// Generate hash untuk inline scripts
function generateHash(script) {
  return createHash('sha256').update(script).digest('base64');
}

export default defineConfig({
  // Astro akan otomatis generate hashes untuk inline scripts
  security: {
    headers: {
      'Content-Security-Policy': [
        "default-src 'self'",
        "script-src 'self' 'sha256-abc123...' 'sha256-def456...'", // Specific hashes
        "style-src 'self' 'sha256-xyz789...'",
        // ... other directives
      ].join('; '),
    },
  },
});
```

### CSP Reporting:

```javascript
// src/pages/api/csp-report.js
export const POST = async ({ request }) => {
  const report = await request.json();
  
  // Log ke monitoring service
  console.error('CSP Violation:', {
    documentURI: report['csp-report']?.['document-uri'],
    blockedURI: report['csp-report']?.['blocked-uri'],
    violatedDirective: report['csp-report']?.['violated-directive'],
    timestamp: new Date().toISOString(),
  });
  
  // Kirim ke Sentry/DataDog/etc
  await sendToMonitoring(report);
  
  return new Response('Report received', { status: 204 });
};
```

```javascript
// Tambahkan ke CSP
"report-uri /api/csp-report; report-to csp-endpoint"

// Atau dengan Report-To header (modern)
"Report-To": JSON.stringify({
  group: 'csp-endpoint',
  max_age: 10886400,
  endpoints: [{ url: '/api/csp-report' }],
});
```

### CSP untuk Third-Party Scripts:

```javascript
// astro.config.mjs
export default defineConfig({
  security: {
    headers: {
      'Content-Security-Policy': [
        "default-src 'self'",
        
        // Google Analytics
        "script-src 'self' https://www.googletagmanager.com https://www.google-analytics.com",
        "connect-src 'self' https://www.google-analytics.com https://region1.google-analytics.com",
        "img-src 'self' https://www.google-analytics.com",
        
        // YouTube embeds
        "frame-src 'self' https://www.youtube.com https://www.youtube-nocookie.com",
        
        // Stripe
        "script-src 'self' https://js.stripe.com",
        "frame-src 'self' https://js.stripe.com https://hooks.stripe.com",
        "connect-src 'self' https://api.stripe.com",
        
        // Sentry
        "connect-src 'self' https://sentry.io https://*.ingest.sentry.io",
      ].join('; '),
    },
  },
});
```

---

## 20.2 Subresource Integrity (SRI)

SRI memastikan file eksternal tidak dimodifikasi dengan memverifikasi hash kriptografis.

### Implementasi SRI:

```astro
---
// src/components/SecureScript.astro
interface Props {
  src: string;
  integrity?: string;
  crossorigin?: 'anonymous' | 'use-credentials';
}

const { src, integrity, crossorigin = 'anonymous' } = Astro.props;

// Generate integrity hash jika tidak disediakan
let finalIntegrity = integrity;
if (!finalIntegrity && src.startsWith('/')) {
  // Generate hash untuk local files
  finalIntegrity = await generateSRIHash(src);
}
---

<script
  src={src}
  integrity={finalIntegrity}
  crossorigin={crossorigin}
></script>

<script>
  // Fallback jika SRI gagal
  window.addEventListener('securitypolicyviolation', (e) => {
    if (e.blockedURI.includes('script')) {
      console.error('Script integrity check failed:', e.blockedURI);
      // Report ke server
      fetch('/api/security-report', {
        method: 'POST',
        body: JSON.stringify({
          type: 'sri-violation',
          blockedURI: e.blockedURI,
          timestamp: new Date().toISOString(),
        }),
      });
    }
  });
</script>
```

```javascript
// src/utils/sri.js
import { readFile } from 'fs/promises';
import { createHash } from 'crypto';
import { fileURLToPath } from 'url';

export async function generateSRIHash(filePath) {
  const content = await readFile(
    fileURLToPath(new URL(`../../public${filePath}`, import.meta.url))
  );
  
  const hash = createHash('sha384').update(content).digest('base64');
  return `sha384-${hash}`;
}
```

### SRI untuk Stylesheets:

```astro
---
// src/components/SecureStylesheet.astro
interface Props {
  href: string;
  integrity?: string;
}

const { href, integrity } = Astro.props;
const finalIntegrity = integrity || await generateSRIHash(href);
---

<link
  rel="stylesheet"
  href={href}
  integrity={finalIntegrity}
  crossorigin="anonymous"
/>
```

### SRI untuk CDN Resources:

```astro
---
// CDN resources dengan known integrity hashes
const cdnResources = {
  react: {
    src: 'https://unpkg.com/react@18/umd/react.production.min.js',
    integrity: 'sha384-123abc...',
  },
  vue: {
    src: 'https://unpkg.com/vue@3/dist/vue.global.js',
    integrity: 'sha384-456def...',
  },
};
---

<script
  src={cdnResources.react.src}
  integrity={cdnResources.react.integrity}
  crossorigin="anonymous"
></script>
```

---

## 20.3 XSS Protection

Cross-Site Scripting (XSS) adalah serangan injeksi malicious scripts. Astro memiliki proteksi bawaan, tapi tetap perlu awareness.

### Astro's Built-in XSS Protection:

```astro
---
// Astro secara OTOMATIS escape output
const userInput = '<script>alert("xss")</script>';
---

<!-- Output: &lt;script&gt;alert("xss")&lt;/script&gt; -->
<p>{userInput}</p>

<!-- Output: <p>&lt;script&gt;alert("xss")&lt;/script&gt;</p> -->
<p set:html={userInput} /> <!-- Hati-hati dengan set:html! -->
```

### Safe HTML Rendering:

```astro
---
// src/components/SafeHTML.astro
import DOMPurify from 'isomorphic-dompurify';

interface Props {
  html: string;
  allowedTags?: string[];
  allowedAttrs?: string[];
}

const { 
  html, 
  allowedTags = ['p', 'br', 'strong', 'em', 'a'],
  allowedAttrs = ['href', 'title', 'target'],
} = Astro.props;

// Sanitize dengan DOMPurify
const cleanHtml = DOMPurify.sanitize(html, {
  ALLOWED_TAGS: allowedTags,
  ALLOWED_ATTR: allowedAttrs,
  ALLOW_DATA_ATTR: false,
  SANITIZE_DOM: true,
});
---

<Fragment set:html={cleanHtml} />
```

### Markdown XSS Prevention:

```javascript
// astro.config.mjs
import { defineConfig } from 'astro/config';
import rehypeSanitize from 'rehype-sanitize';
import rehypeExternalLinks from 'rehype-external-links';

export default defineConfig({
  markdown: {
    rehypePlugins: [
      // Sanitize HTML di markdown
      [rehypeSanitize, {
        allowElements: ['p', 'h1', 'h2', 'h3', 'ul', 'ol', 'li', 'a', 'strong', 'em', 'code'],
        allowAttributes: {
          a: ['href', 'title'],
          code: ['class'],
        },
      }],
      
      // Add rel="noopener noreferrer" ke external links
      [rehypeExternalLinks, {
        target: '_blank',
        rel: ['noopener', 'noreferrer', 'nofollow'],
      }],
    ],
  },
});
```

### URL Validation:

```astro
---
// src/components/SafeLink.astro
interface Props {
  href: string;
  children: any;
  class?: string;
}

const { href, class: className } = Astro.props;

// Validasi URL
function isValidUrl(url) {
  try {
    const parsed = new URL(url, Astro.site);
    
    // Hanya allow http/https
    if (!['http:', 'https:'].includes(parsed.protocol)) {
      return false;
    }
    
    // Prevent javascript: protocol
    if (parsed.protocol === 'javascript:') {
      return false;
    }
    
    // Prevent data: URLs (kecuali untuk images)
    if (parsed.protocol === 'data:' && !url.startsWith('data:image/')) {
      return false;
    }
    
    return true;
  } catch {
    return false;
  }
}

// Sanitize URL
const safeHref = isValidUrl(href) ? href : '#';
const isExternal = safeHref.startsWith('http') && !safeHref.includes(Astro.site.hostname);
---

<a 
  href={safeHref}
  class={className}
  {...isExternal && { 
    target: '_blank', 
    rel: 'noopener noreferrer nofollow' 
  }}
>
  <slot />
</a>
```

### Form XSS Prevention:

```typescript
// src/actions/index.ts
import { defineAction } from 'astro:actions';
import { z } from 'astro:schema';
import DOMPurify from 'isomorphic-dompurify';

export const server = {
  submitComment: defineAction({
    accept: 'form',
    input: z.object({
      name: z.string().min(1).max(100).transform(val => 
        DOMPurify.sanitize(val, { ALLOWED_TAGS: [] })
      ),
      email: z.string().email(),
      comment: z.string().min(1).max(5000).transform(val =>
        DOMPurify.sanitize(val, {
          ALLOWED_TAGS: ['p', 'br', 'strong', 'em', 'a'],
          ALLOWED_ATTR: ['href', 'title'],
        })
      ),
    }),
    handler: async (input) => {
      // Data sudah sanitized
      await db.insert(comments).values({
        name: input.name,      // Plain text
        email: input.email,    // Validated email
        comment: input.comment, // Sanitized HTML
        createdAt: new Date(),
      });
      
      return { success: true };
    },
  }),
};
```

---

## 20.4 CSRF Protection

Cross-Site Request Forgery (CSRF) memaksa user melakukan aksi tidak diinginkan di site yang terautentikasi.

### CSRF Token Implementation:

```javascript
// src/middleware/csrf.js
import { defineMiddleware } from 'astro:middleware';
import { randomBytes } from 'crypto';

export const csrfMiddleware = defineMiddleware(async (context, next) => {
  // Generate CSRF token
  let csrfToken = context.cookies.get('csrf-token')?.value;
  
  if (!csrfToken) {
    csrfToken = randomBytes(32).toString('hex');
    context.cookies.set('csrf-token', csrfToken, {
      httpOnly: false, // Harus accessible oleh JavaScript
      secure: true,
      sameSite: 'strict',
      path: '/',
      maxAge: 60 * 60 * 24, // 24 jam
    });
  }
  
  context.locals.csrfToken = csrfToken;
  
  // Validasi untuk POST/PUT/DELETE/PATCH
  if (['POST', 'PUT', 'DELETE', 'PATCH'].includes(context.request.method)) {
    const contentType = context.request.headers.get('content-type') || '';
    
    // Skip untuk JSON API dengan proper auth
    if (contentType.includes('application/json')) {
      const origin = context.request.headers.get('origin');
      const allowedOrigins = [context.url.origin];
      
      if (!origin || !allowedOrigins.includes(origin)) {
        return new Response('Invalid origin', { status: 403 });
      }
    } else {
      // Form submission - check CSRF token
      const formData = await context.request.clone().formData();
      const submittedToken = formData.get('_csrf');
      
      if (submittedToken !== csrfToken) {
        return new Response('Invalid CSRF token', { status: 403 });
      }
    }
  }
  
  return next();
});
```

```astro
---
// src/components/CSRFToken.astro
const csrfToken = Astro.locals.csrfToken;
---

<!-- Hidden input untuk semua forms -->
<input type="hidden" name="_csrf" value={csrfToken} />

<!-- Atau sebagai meta tag untuk JavaScript -->
<meta name="csrf-token" content={csrfToken} />

<script>
  // Auto-add CSRF token ke semua forms
  document.querySelectorAll('form').forEach(form => {
    if (!form.querySelector('input[name="_csrf"]')) {
      const token = document.querySelector('meta[name="csrf-token"]')?.content;
      if (token) {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = '_csrf';
        input.value = token;
        form.appendChild(input);
      }
    }
  });
  
  // Add ke fetch requests
  const originalFetch = window.fetch;
  window.fetch = function(url, options = {}) {
    if (options.method && options.method !== 'GET') {
      const token = document.querySelector('meta[name="csrf-token"]')?.content;
      options.headers = {
        ...options.headers,
        'X-CSRF-Token': token,
      };
    }
    return originalFetch(url, options);
  };
</script>
```

### Double Submit Cookie Pattern:

```javascript
// src/middleware/csrf-double-submit.js
import { defineMiddleware } from 'astro:middleware';
import { randomBytes, createHmac } from 'crypto';

const SECRET = process.env.CSRF_SECRET; // Server-side secret

export const csrfDoubleSubmit = defineMiddleware(async (context, next) => {
  // Generate token
  const token = randomBytes(32).toString('hex');
  const signature = createHmac('sha256', SECRET).update(token).digest('hex');
  const csrfToken = `${token}.${signature}`;
  
  context.cookies.set('csrf-token', csrfToken, {
    httpOnly: true,
    secure: true,
    sameSite: 'strict',
  });
  
  // Kirim token tanpa signature ke client
  context.locals.csrfToken = token;
  
  // Validasi
  if (['POST', 'PUT', 'DELETE'].includes(context.request.method)) {
    const submittedToken = context.request.headers.get('x-csrf-token');
    const cookieToken = context.cookies.get('csrf-token')?.value;
    
    if (!submittedToken || !cookieToken) {
      return new Response('CSRF token missing', { status: 403 });
    }
    
    // Verify signature
    const [cookieValue, cookieSig] = cookieToken.split('.');
    const expectedSig = createHmac('sha256', SECRET).update(cookieValue).digest('hex');
    
    if (submittedToken !== cookieValue || cookieSig !== expectedSig) {
      return new Response('Invalid CSRF token', { status: 403 });
    }
  }
  
  return next();
});
```

---

## 20.5 Secure Headers

Security headers tambahan untuk defense in depth.

### Complete Security Headers:

```javascript
// src/middleware/security-headers.js
import { defineMiddleware } from 'astro:middleware';

export const securityHeaders = defineMiddleware(async (context, next) => {
  const response = await next();
  
  // Strict-Transport-Security (HSTS)
  response.headers.set(
    'Strict-Transport-Security',
    'max-age=31536000; includeSubDomains; preload'
  );
  
  // X-Content-Type-Options
  response.headers.set('X-Content-Type-Options', 'nosniff');
  
  // X-Frame-Options (clickjacking protection)
  response.headers.set('X-Frame-Options', 'DENY');
  
  // X-XSS-Protection (legacy browser)
  response.headers.set('X-XSS-Protection', '1; mode=block');
  
  // Referrer-Policy
  response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');
  
  // Permissions-Policy (Feature-Policy)
  response.headers.set(
    'Permissions-Policy',
    [
      'accelerometer=()',
      'camera=()',
      'geolocation=(self)',
      'gyroscope=()',
      'magnetometer=()',
      'microphone=()',
      'payment=()',
      'usb=()',
    ].join(', ')
  );
  
  // Cross-Origin policies
  response.headers.set('Cross-Origin-Resource-Policy', 'same-origin');
  response.headers.set('Cross-Origin-Opener-Policy', 'same-origin');
  response.headers.set('Cross-Origin-Embedder-Policy', 'require-corp');
  
  return response;
});
```

### Config-based Headers:

```javascript
// astro.config.mjs
export default defineConfig({
  security: {
    headers: {
      'Strict-Transport-Security': 'max-age=31536000; includeSubDomains',
      'X-Content-Type-Options': 'nosniff',
      'X-Frame-Options': 'DENY',
      'Referrer-Policy': 'strict-origin-when-cross-origin',
      'Permissions-Policy': 'camera=(), microphone=(), geolocation=(self)',
    },
  },
});
```

---

## 20.6 Authentication & Authorization

Implementasi auth yang aman di Astro.

### Session-based Auth:

```javascript
// src/middleware/auth.js
import { defineMiddleware } from 'astro:middleware';
import { verifyToken } from '../lib/jwt.js';

export const authMiddleware = defineMiddleware(async (context, next) => {
  // Public paths
  const publicPaths = ['/login', '/register', '/api/auth/login', '/api/auth/register'];
  if (publicPaths.some(p => context.url.pathname.startsWith(p))) {
    return next();
  }
  
  // Verify session
  const sessionToken = context.cookies.get('session')?.value;
  
  if (!sessionToken) {
    return context.redirect('/login?redirect=' + encodeURIComponent(context.url.pathname));
  }
  
  try {
    const user = await verifyToken(sessionToken, process.env.JWT_SECRET);
    context.locals.user = user;
  } catch (error) {
    context.cookies.delete('session');
    return context.redirect('/login');
  }
  
  return next();
});
```

### OAuth Integration (Auth.js):

```bash
npm install @auth/core @auth/astro
```

```javascript
// auth.config.js
import { defineConfig } from '@auth/astro';
import Google from '@auth/core/providers/google';

export default defineConfig({
  providers: [
    Google({
      clientId: process.env.GOOGLE_CLIENT_ID,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET,
    }),
  ],
  secret: process.env.AUTH_SECRET,
  trustHost: true,
  callbacks: {
    async session({ session, token }) {
      session.user.id = token.sub;
      return session;
    },
  },
});
```

```astro
---
// src/pages/protected.astro
import { getSession } from '@auth/astro';

const session = await getSession(Astro.request);

if (!session) {
  return Astro.redirect('/auth/signin');
}

// Check authorization
if (!session.user.email.endsWith('@company.com')) {
  return new Response('Forbidden', { status: 403 });
}
---

<h1>Welcome, {session.user.name}</h1>
```

### Role-based Access Control (RBAC):

```javascript
// src/lib/rbac.js
export const ROLES = {
  USER: 'user',
  EDITOR: 'editor',
  ADMIN: 'admin',
};

export const PERMISSIONS = {
  [ROLES.USER]: ['read:own', 'update:own'],
  [ROLES.EDITOR]: ['read:all', 'create:all', 'update:all', 'delete:own'],
  [ROLES.ADMIN]: ['*'],
};

export function hasPermission(user, permission) {
  const userPerms = PERMISSIONS[user.role] || [];
  return userPerms.includes('*') || userPerms.includes(permission);
}
```

```astro
---
// src/pages/admin/users.astro
import { hasPermission, ROLES } from '../../lib/rbac.js';

const user = Astro.locals.user;

if (!hasPermission(user, 'read:all')) {
  return new Response('Forbidden', { status: 403 });
}

const users = await db.select().from(usersTable);
---

<h1>User Management</h1>

{hasPermission(user, 'create:all') && (
  <a href="/admin/users/new">Add User</a>
)}

<ul>
  {users.map(u => (
    <li>
      {u.email} - {u.role}
      {hasPermission(user, 'update:all') && (
        <a href={`/admin/users/${u.id}/edit`}>Edit</a>
      )}
      {hasPermission(user, 'delete:all') && u.id !== user.id && (
        <form method="POST" action={`/api/users/${u.id}/delete`}>
          <button type="submit">Delete</button>
        </form>
      )}
    </li>
  ))}
</ul>
```

### Password Security:

```javascript
// src/lib/password.js
import { hash, verify } from '@node-rs/argon2';

// Argon2 configuration (OWASP recommended)
const ARGON2_CONFIG = {
  memoryCost: 65536,  // 64 MB
  timeCost: 3,        // 3 iterations
  parallelism: 4,     // 4 parallel threads
  hashLength: 32,     // 32 byte output
};

export async function hashPassword(password) {
  return hash(password, ARGON2_CONFIG);
}

export async function verifyPassword(password, hash) {
  return verify(hash, password);
}

// Password validation
export function validatePassword(password) {
  const minLength = 12;
  const hasUpperCase = /[A-Z]/.test(password);
  const hasLowerCase = /[a-z]/.test(password);
  const hasNumbers = /\d/.test(password);
  const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/.test(password);
  
  const errors = [];
  if (password.length < minLength) errors.push(`Minimum ${minLength} characters`);
  if (!hasUpperCase) errors.push('At least one uppercase letter');
  if (!hasLowerCase) errors.push('At least one lowercase letter');
  if (!hasNumbers) errors.push('At least one number');
  if (!hasSpecialChar) errors.push('At least one special character');
  
  return {
    valid: errors.length === 0,
    errors,
  };
}
```

---

## Ringkasan Keamanan Komprehensif

### Security Checklist:

| Layer | Implementasi | Status |
|-------|--------------|--------|
| **CSP** | Strict policy dengan nonce/hash | ☐ |
| **SRI** | Integrity hashes untuk external resources | ☐ |
| **XSS** | Auto-escape + DOMPurify + CSP | ☐ |
| **CSRF** | Token validation + SameSite cookies | ☐ |
| **Headers** | HSTS, X-Frame-Options, Permissions-Policy | ☐ |
| **Auth** | Secure sessions + JWT + RBAC | ☐ |
| **Passwords** | Argon2 hashing + strong validation | ☐ |
| **HTTPS** | Force TLS + HSTS preload | ☐ |
| **CORS** | Strict origin validation | ☐ |
| **Rate Limiting** | Brute force protection | ☐ |

### Security Headers Template:

```javascript
// src/middleware/security.js
export const securityMiddleware = defineMiddleware(async (context, next) => {
  const response = await next();
  
  // Comprehensive security headers
  const headers = {
    'Content-Security-Policy': "default-src 'self'; script-src 'self' 'nonce-{nonce}'; style-src 'self' 'nonce-{nonce}'; img-src 'self' data: https:; font-src 'self'; connect-src 'self'; object-src 'none'; frame-ancestors 'none'; base-uri 'self'; form-action 'self'; upgrade-insecure-requests;",
    'Strict-Transport-Security': 'max-age=31536000; includeSubDomains; preload',
    'X-Content-Type-Options': 'nosniff',
    'X-Frame-Options': 'DENY',
    'X-XSS-Protection': '0', // Disabled karena CSP sudah cukup
    'Referrer-Policy': 'strict-origin-when-cross-origin',
    'Permissions-Policy': 'accelerometer=(), camera=(), geolocation=(self), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()',
    'Cross-Origin-Resource-Policy': 'same-origin',
    'Cross-Origin-Opener-Policy': 'same-origin',
    'Cross-Origin-Embedder-Policy': 'require-corp',
  };
  
  Object.entries(headers).forEach(([key, value]) => {
    response.headers.set(key, value);
  });
  
  return response;
});
```

---

**Selanjutnya:** Di Sesi 21, kita akan membahas **Accessibility (A11y)** - membangun website yang accessible untuk semua pengguna termasuk yang menggunakan assistive technologies.
